var tongDonHang = 0;
var tongTienHang = 0;
var tongTienTietKiem=0;
var tongTienChiTieu=0;
var tongSanPhamDaMua = 0;
var trangThaiDonHangConKhong  = true;
var tongTienVanChuyenPhaiTra=0;
var tongTienVanChuyenChuaGiam=0;
var tongTienVanChuyenDuocGiam=0;
var tongTienTietKiemMGGTiki=0;
var tongTienTietKiemBangTikiXu=0;
var pNo = 1;
var si=10;
function xemBaoCaoThongKe() {
	var donHang = [];
	var xhttp = new XMLHttpRequest();
	xhttp.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
			donHang = JSON.parse(this.responseText)['data'];
			trangThaiDonHangConKhong  = donHang.length >= si;
			donHang = donHang.filter(order => order['status'] == 'hoan_thanh');
			tongDonHang += donHang.length;
			donHang.forEach(order => {
				let t1 = order["grand_total"];
				tongTienChiTieu += t1;
				tongSanPhamDaMua+=order["items"].length;
				var ships= [];
				var discounts= [];
				var disXu=[];
				var tongTienHangOri=[];
				if(order["price_summary"]){
					ships=order["price_summary"].filter(s => s['name'] == 'PhÃ­ váº­n chuyá»ƒn');
					ships.forEach(ship => {
						let t2 = ship["value"];
						tongTienVanChuyenPhaiTra+=t2;
					});
					discounts=order["price_summary"].filter(s => s['name'] == 'Giáº£m giÃ¡');
					discounts.forEach(x1 => {
						let t3 = x1["value"];
						tongTienTietKiemMGGTiki+=Math.abs(t3);
					});
					disXu=order["price_summary"].filter(s => s['name'] == 'Thanh toÃ¡n báº±ng Tiki Xu');
					disXu.forEach(x2 => {
						let t4 = x2["value"];
						tongTienTietKiemBangTikiXu+=Math.abs(t4);
					});
					tongTienHangOri=order["price_summary"].filter(s => s['name'] == 'Táº¡m tÃ­nh');
					tongTienHangOri.forEach(x3 => {
						let t5 = x3["value"];
						tongTienHang+=t5;
					});
				}
			});
			pNo += 1;
			console.log('ÄÃ£ thá»‘ng kÃª Ä‘Æ°á»£c: ' + tongDonHang + ' Ä‘Æ¡n hÃ ng');
			if(trangThaiDonHangConKhong) {
				console.log('Äá»£i chÃºt tui Ä‘ang xá»­ lÃ½...');
				xemBaoCaoThongKe();
			}
			else {
				console.clear();
				var tongTienChiTieuX=pxgPrice(tongTienChiTieu);
				tongTienHang=tongTienHang+tongTienVanChuyenPhaiTra;
				tongTienVanChuyenChuaGiam=tongTienVanChuyenPhaiTra+tongTienVanChuyenDuocGiam;
				tongTienTietKiem=tongTienTietKiemMGGTiki+tongTienTietKiemBangTikiXu+tongTienVanChuyenDuocGiam;
				console.log("================================");
				console.log("%c"+PXGCert(tongTienChiTieu), "font-size:26px;");
				console.log("%cHáº¿t cÃ³: "+"%c"+tongTienChiTieuX+" vnÄ‘%c chá»© nhiÃªu hÃ¬ hÃ¬", "font-size: 20px;","font-size: 26px; color:red;font-weigth:700", "font-size: 20px;");
				console.log("================================");
				console.log("%cTá»•ng Ä‘Æ¡n hÃ ng Ä‘Ã£ giao: "+"%c"+pxgPrice(tongDonHang)+" Ä‘Æ¡n hÃ ng", "font-size: 26px;","font-size: 26px; color:green");
                console.log("%cTá»•ng sáº£n pháº©m Ä‘Ã£ Ä‘áº·t: " + "%c" + pxgPrice(tongSanPhamDaMua)+" sáº£n pháº©m", "font-size: 20px;","font-size: 20px; color:#fc0000");
                console.log("%cTá»•ng tiá»n hÃ ng thá»±c táº¿ khi khÃ´ng dÃ¹ng MggTiki vÃ  Tiki XU: "+"%c"+pxgPrice(tongTienHang)+" vnÄ‘", "font-size: 20px;","font-size: 20px; color:#fc0000");
                console.log("%cTá»•ng tiá»n váº­n chuyá»ƒn Ä‘Ã£ tráº£: "+"%c"+pxgPrice(tongTienVanChuyenPhaiTra)+" vnÄ‘", "font-size: 20px;","font-size: 20px; color:#fc0000");
				console.log("%cTá»•ng tiá»n hÃ ng + tiá»n ship: "+"%c"+tongTienChiTieuX+" vnÄ‘", "font-size: 26px;","font-size: 26px; color:#fc0000");
				console.log("================================");
				console.log("%cTá»•ng tiá»n váº­n chuyá»ƒn náº¿u khÃ´ng dÃ¹ng mÃ£ freeship Tiki: "+"%c"+pxgPrice(tongTienVanChuyenChuaGiam)+" vnÄ‘", "font-size: 18px;","font-size: 18px; color:#fc0000");
				console.log("%cTá»•ng tiá»n váº­n chuyá»ƒn tiáº¿t kiá»‡m Ä‘Æ°á»£c khi dÃ¹ng mÃ£ freeship Tiki: "+"%c"+pxgPrice(tongTienVanChuyenDuocGiam)+" vnÄ‘", "font-size: 18px;","font-size: 18px; color:green");
				console.log("%cTá»•ng tiá»n tiáº¿t kiá»‡m Ä‘Æ°á»£c khi dÃ¹ng MggTiki: "+"%c"+pxgPrice(tongTienTietKiemMGGTiki)+" vnÄ‘", "font-size: 18px;","font-size: 18px; color:green");
				console.log("%cTá»•ng tiá»n tiáº¿t kiá»‡m Ä‘Æ°á»£c khi dÃ¹ng Tiki XU: "+"%c"+pxgPrice(tongTienTietKiemBangTikiXu)+" vnÄ‘", "font-size: 18px;","font-size: 18px; color:green");
				console.log("%cTá»•ng tiá»n tiáº¿t kiá»‡m Ä‘Æ°á»£c: "+"%c"+pxgPrice(tongTienTietKiem)+" vnÄ‘", "font-size: 18px;","font-size: 18px; color:green");
				console.log("================================");
				console.log("%cðŸ”´Nháº­n mÃ£ giáº£m giÃ¡ "+getDate()+"ðŸ”¥", "font-size: 26px;");
				console.log("%cðŸ‘‰Tiki: "+"%chttps://mggtiki.com", "font-size: 18px;","font-size: 18px; color:#fc0000");
				console.log("%cðŸ‘‰Fahasa: "+"%chttps://magiamgiafahasa.com", "font-size: 18px;","font-size: 18px; color:#fc0000");
				console.log("%cðŸ‘‰Shopee khung giá»: "+"%chttps://mggshopee.net", "font-size: 18px;","font-size: 18px; color:#fc0000");
				console.log("%cðŸ‘‰Lazada: "+"%chttps://mgglazada.com", "font-size: 18px;","font-size: 18px; color:#fc0000");
				console.log("%cðŸ‘‰Äiá»‡n MÃ¡y XANH: "+"%chttps://magiamgiadienmayxanh.com", "font-size: 18px;","font-size: 18px; color:#fc0000");
				console.log("%cðŸ‘‰Tháº¿ Giá»›i Di Äá»™ng: "+"%chttps://magiamgiathegioididong.com", "font-size: 18px;","font-size: 18px; color:#fc0000");
				console.log("================================");
				console.log("%câœ…Xem lá»‹ch sá»­ giÃ¡ sáº£n pháº©m tÄƒng/ giáº£m", "font-size: 26px;");
				console.log("%cðŸ‘‰LichSuGia.vn: "+"%chttps://lichsugia.vn", "font-size: 18px;","font-size: 18px; color:#fc0000");
				console.log("%cðŸ‘‰Tiá»‡n Ã­ch tra Lá»‹ch Sá»­ GiÃ¡ VN: "+"%chttps://thank.zone/LichSuGiaVNExt", "font-size: 18px;","font-size: 18px; color:#fc0000");
			}
		}
	};
	xhttp.open("GET", "https://tiki.vn/api/v2/me/orders?page=" + pNo + "&limit="+si+"&include=items,price_summary", true);
	xhttp.send();
}
const getDate = () => {
  const newDate = new Date();
  const year = newDate.getFullYear();
  const month = newDate.getMonth() + 1;
  const d = newDate.getDate();
  
  return `${d.toString()}/${month.toString()}/${year}`;
}
function PXGCert(pri){
  if(pri<=10000000){
  	return "MÃ¬nh mua sáº¯m cÅ©ng THÆ¯á»œNG ha";
  }else if(pri>10000000 &&pri<=50000000){
  	return "MÃ¬nh mua sáº¯m cÅ©ng TÃ€M Táº M ha";
  }else if(pri>50000000 &&pri<80000000){
  	return "MÃ¬nh mua sáº¯m hÆ¡i bá»‹ KINH ÄÃ“ hÆ¡";
  }else{
  	return "MÃ¬nh lÃ  báº­c tháº§y mua sáº¯m, lÃ  THÃNH TIKI kaka";
  }
}
function pxgPrice(no, fixed=0) {
	if(isNaN(no)) return 0;
	no = no.toFixed(fixed);
	let deli = ',';
	no += '';
	let rgx = /(\d+)(\d{3})/;
	while (rgx.test(no)) {
		no = no.replace(rgx, '$1' + deli + '$2');
	}
	return no;
}
xemBaoCaoThongKe();
